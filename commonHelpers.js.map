{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport SimpleLightbox from 'simplelightbox';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst API_URL = 'https://pixabay.com/api';\nconst AUTH_TOKEN = '42319756-1866d229574eee1c1aa4e15c2';\nconst CLASS_HIDDEN = 'hidden';\naxios.defaults.baseURL = API_URL;\n\nconst alertError = {\n  message:\n    'Sorry, there are no images matching your search query. Please try again!',\n  color: '#FFA000',\n  position: 'topRight',\n  icon: 'icon-octagon',\n  iconText: '',\n  timeout: 5000,\n  titleColor: '#fff',\n  messageColor: '#fff',\n  iconColor: '#fff',\n};\n\nconst paramsOptions = {\n  key: AUTH_TOKEN,\n  image_type: 'photo',\n  orientation: 'horizontal',\n  safesearch: true,\n  per_page: 20,\n};\n\nconst findPhotoForm = document.querySelector('.form');\nconst galleryList = document.querySelector('ul.gallery');\nconst loader = document.querySelector('.loader');\nconst showMoreButton = document.querySelector('#show-more');\n\nlet loadedPage = 1,\n  totalHits = 1,\n  searchQuery = '';\n\nconst lightbox = new SimpleLightbox('.gallery a', {\n  sourceAttr: 'data-source',\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nconst addPhotos = photos => {\n  galleryList.insertAdjacentHTML(\n    'beforeend',\n    photos\n      .map(photo => {\n        return `<li class=\"gallery-item\">\n                  <a class=\"gallery-link\" href=\"${photo.largeImageURL}\" data-source=\"${photo.largeImageURL}\">\n                    <img class=\"gallery-image\" src=\"${photo.webformatURL}\"  alt=\"${photo.tags}\"/>\n                  </a>\n                </li>`;\n      })\n      .join('')\n  );\n  lightbox.refresh();\n};\n\nconst galleryScroll = (page, itemsInPage) => {\n  const indexOfItem = itemsInPage * (page - 1);\n  const galleryItemPosition =\n    galleryList.children[indexOfItem].getBoundingClientRect();\n  window.scrollBy({\n    top: galleryItemPosition.y,\n    left: 0,\n    behavior: 'smooth',\n  });\n};\n\nconst fetchPhotos = async (value, page) => {\n  const response = await axios.get('/', {\n    params: { ...paramsOptions, q: value, page },\n  });\n  return response.data;\n};\n\nconst handleSearchSubmit = async event => {\n  event.preventDefault();\n  const searchText = event.target.elements.search.value.trim();\n  event.target.elements.search.value = '';\n\n  showMoreButton.classList.add(CLASS_HIDDEN);\n  loader.classList.remove(CLASS_HIDDEN);\n\n  galleryList.innerHTML = '';\n  loadedPage = 1;\n\n  try {\n    const photos = await fetchPhotos(searchText, loadedPage);\n\n    if (!photos.totalHits) {\n      iziToast.show(alertError);\n      return;\n    }\n\n    addPhotos(photos.hits);\n    loadedPage++;\n    searchQuery = searchText;\n    totalHits = Math.ceil(photos.totalHits / paramsOptions.per_page);\n\n    if (totalHits > 1) showMoreButton.classList.remove(CLASS_HIDDEN);\n    else\n      iziToast.show({\n        ...alertError,\n        message: \"We're sorry, but you've reached the end of search results.\",\n      });\n  } catch (error) {\n    iziToast.show({ ...alertError, message: error.message, color: '#EF4040' });\n  } finally {\n    loader.classList.add(CLASS_HIDDEN);\n  }\n};\n\nconst handleSearchMore = async () => {\n  loader.classList.remove(CLASS_HIDDEN);\n  showMoreButton.classList.add(CLASS_HIDDEN);\n\n  try {\n    const photos = await fetchPhotos(searchQuery, loadedPage);\n\n    addPhotos(photos.hits);\n    galleryScroll(loadedPage, paramsOptions.per_page);\n\n    loadedPage++;\n  } catch (error) {\n    iziToast.show({ ...alertError, message: error.message });\n  } finally {\n    if (totalHits >= loadedPage) showMoreButton.classList.add(CLASS_HIDDEN);\n    else\n      iziToast.show({\n        ...alertError,\n        message: \"We're sorry, but you've reached the end of search results.\",\n      });\n    loader.classList.add(CLASS_HIDDEN);\n  }\n};\n\nfindPhotoForm.addEventListener('submit', handleSearchSubmit);\nshowMoreButton.addEventListener('click', handleSearchMore);\n"],"names":["API_URL","AUTH_TOKEN","CLASS_HIDDEN","axios","alertError","paramsOptions","findPhotoForm","galleryList","loader","showMoreButton","loadedPage","totalHits","searchQuery","lightbox","SimpleLightbox","addPhotos","photos","photo","galleryScroll","page","itemsInPage","indexOfItem","galleryItemPosition","fetchPhotos","value","handleSearchSubmit","event","searchText","iziToast","error","handleSearchMore"],"mappings":"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"}